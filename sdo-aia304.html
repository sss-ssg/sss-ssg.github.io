<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solar Imaging Viewer</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        #content {
            display: flex;
            flex-direction: row;
            justify-content: space-around;
            width: 90%;
            margin-top: 20px;
        }
        #image-container, #video-container {
            border: 1px solid #ccc;
            padding: 10px;
            border-radius: 5px;
        }
        canvas {
            width: 100%;
            height: auto;
        }
    </style>
</head>
<body>
    <h1>Solar Imaging Viewer</h1>
    <div id="content">
        <div id="image-container">
            <h2>Latest AIA 304 Image</h2>
            <img id="latest-image" alt="Latest AIA 304 Image" width="400"/>
        </div>
        <div id="video-container">
            <h2>72-Hour AIA 304 Video</h2>
            <canvas id="video-canvas" width="400" height="300"></canvas>
        </div>
    </div>

    <script>
        const apiBaseUrl = "https://api.helioviewer.org/v2";

        async function fetchLatestImage() {
            try {
                const response = await fetch(`${apiBaseUrl}/getClosestImage/?sourceId=10&date=${new Date().toISOString()}&observatory=SDO&instrument=AIA&detector=AIA&measurement=304`);
                const data = await response.json();
                const imageUrl = data.url;

                document.getElementById('latest-image').src = imageUrl;
            } catch (error) {
                console.error("Error fetching latest image:", error);
            }
        }

        async function fetchVideo() {
            try {
                const startDate = new Date();
                startDate.setHours(startDate.getHours() - 72);

                const response = await fetch(`${apiBaseUrl}/createMovie/?startTime=${startDate.toISOString()}&endTime=${new Date().toISOString()}&sourceId=10&observatory=SDO&instrument=AIA&measurement=304&resolution=512&format=mp4`);
                const data = await response.json();

                const videoCanvas = document.getElementById('video-canvas');
                const ctx = videoCanvas.getContext('2d');
                const video = document.createElement('video');
                video.src = data.url;
                video.autoplay = true;
                video.loop = true;
                video.muted = true;

                video.addEventListener('play', () => {
                    function drawFrame() {
                        if (!video.paused && !video.ended) {
                            ctx.drawImage(video, 0, 0, videoCanvas.width, videoCanvas.height);
                            requestAnimationFrame(drawFrame);
                        }
                    }
                    drawFrame();
                });
            } catch (error) {
                console.error("Error fetching video:", error);
            }
        }

        fetchLatestImage();
        fetchVideo();
    </script>
</body>
</html>
